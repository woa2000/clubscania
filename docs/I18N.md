# Internacionalização (i18n)

## Visão Geral

O aplicativo suporta **2 idiomas**: Português (pt) e Inglês (en), usando **React i18next** para gerenciamento de traduções.

---

## Configuração

### Instalação

```bash
npm install react-i18next i18next
```

### Estrutura de Arquivos

```
src/languages/
├── i18n.js              # Configuração do i18next
├── portuguese.json      # Traduções em Português
├── english.json         # Traduções em Inglês
└── translateDB.js       # Traduções de dados do banco
```

---

## Configuração do i18next

**Arquivo**: `src/languages/i18n.js`

```javascript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import pt from './portuguese.json';
import en from './english.json';

i18n
  .use(initReactI18next)
  .init({
    resources: {
      pt: {
        translation: pt
      },
      en: {
        translation: en
      }
    },
    lng: 'pt', // Idioma padrão
    fallbackLng: 'pt',
    interpolation: {
      escapeValue: false // React já protege contra XSS
    }
  });

export default i18n;
```

---

## Arquivos de Tradução

### portuguese.json

```json
{
  "Bem-vindo": "Bem-vindo",
  "Entrar": "Entrar",
  "Cadastrar": "Cadastrar",
  "E-mail": "E-mail",
  "Senha": "Senha",
  "Esqueceu a senha?": "Esqueceu a senha?",
  "Criar conta": "Criar conta",
  "Home": "Início",
  "Atividades": "Atividades",
  "Centro Estético": "Centro Estético",
  "Espaços": "Espaços",
  "Perfil": "Perfil",
  "Configurações": "Configurações",
  "Meus Dados": "Meus Dados",
  "Trocar Senha": "Trocar Senha",
  "Idioma": "Idioma",
  "Sair": "Sair",
  "Academia": "Academia",
  "Eventos": "Eventos",
  "Lanchonete": "Lanchonete",
  "Exames": "Exames",
  "Reservar": "Reservar",
  "Cancelar": "Cancelar",
  "Confirmar": "Confirmar",
  "Voltar": "Voltar",
  "Salvar": "Salvar",
  "Editar": "Editar",
  "Excluir": "Excluir",
  "Buscar": "Buscar",
  "Filtrar": "Filtrar",
  "Data": "Data",
  "Horário": "Horário",
  "Vagas Disponíveis": "Vagas Disponíveis",
  "Agendamentos": "Agendamentos",
  "Histórico": "Histórico",
  "Detalhes": "Detalhes",
  "Descrição": "Descrição",
  "Selecione uma data": "Selecione uma data",
  "Selecione um horário": "Selecione um horário",
  "Agendamento realizado com sucesso": "Agendamento realizado com sucesso",
  "Erro ao realizar agendamento": "Erro ao realizar agendamento",
  "Sem conexão com a internet": "Sem conexão com a internet",
  "Carregando...": "Carregando...",
  "Nenhum item encontrado": "Nenhum item encontrado"
}
```

### english.json

```json
{
  "Bem-vindo": "Welcome",
  "Entrar": "Login",
  "Cadastrar": "Sign Up",
  "E-mail": "Email",
  "Senha": "Password",
  "Esqueceu a senha?": "Forgot password?",
  "Criar conta": "Create account",
  "Home": "Home",
  "Atividades": "Activities",
  "Centro Estético": "Beauty Center",
  "Espaços": "Spaces",
  "Perfil": "Profile",
  "Configurações": "Settings",
  "Meus Dados": "My Data",
  "Trocar Senha": "Change Password",
  "Idioma": "Language",
  "Sair": "Logout",
  "Academia": "Gym",
  "Eventos": "Events",
  "Lanchonete": "Snack Bar",
  "Exames": "Exams",
  "Reservar": "Book",
  "Cancelar": "Cancel",
  "Confirmar": "Confirm",
  "Voltar": "Back",
  "Salvar": "Save",
  "Editar": "Edit",
  "Excluir": "Delete",
  "Buscar": "Search",
  "Filtrar": "Filter",
  "Data": "Date",
  "Horário": "Time",
  "Vagas Disponíveis": "Available Spots",
  "Agendamentos": "Appointments",
  "Histórico": "History",
  "Detalhes": "Details",
  "Descrição": "Description",
  "Selecione uma data": "Select a date",
  "Selecione um horário": "Select a time",
  "Agendamento realizado com sucesso": "Appointment successfully scheduled",
  "Erro ao realizar agendamento": "Error scheduling appointment",
  "Sem conexão com a internet": "No internet connection",
  "Carregando...": "Loading...",
  "Nenhum item encontrado": "No items found"
}
```

---

## Uso em Componentes

### Hook useTranslation

```typescript
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t, i18n } = useTranslation();

  return (
    <View>
      <Text>{t("Bem-vindo")}</Text>
      <Text>{t("Idioma atual")}: {i18n.language}</Text>
    </View>
  );
}
```

### Tradução Simples

```typescript
<Text>{t("Entrar")}</Text>
// Português: "Entrar"
// Inglês: "Login"
```

### Tradução com Interpolação

```typescript
// portuguese.json
{
  "Olá, {{name}}!": "Olá, {{name}}!"
}

// english.json
{
  "Olá, {{name}}!": "Hello, {{name}}!"
}

// Uso
<Text>{t("Olá, {{name}}!", { name: user.nome })}</Text>
```

### Tradução com Plural

```typescript
// portuguese.json
{
  "item": "{{count}} item",
  "item_plural": "{{count}} itens"
}

// english.json
{
  "item": "{{count}} item",
  "item_plural": "{{count}} items"
}

// Uso
<Text>{t("item", { count: items.length })}</Text>
```

---

## Mudança de Idioma

### No AuthContext

```typescript
async function updateLanguage(language: string) {
  console.log('setLanguage -> ', language);
  setLanguage(language);
  await AsyncStorage.setItem('@ClubeScania:language', JSON.stringify(language));
  i18n.changeLanguage(language);
}
```

### Tela de Seleção de Idioma

**Arquivo**: `src/screens/Language`

```typescript
import React from 'react';
import { useAuth } from '../../contexts/auth';
import { SelectButton } from '../../components/SelectButton';

export function Language() {
  const { language, updateLanguage } = useAuth();

  const handleSelectLanguage = async (lang: string) => {
    await updateLanguage(lang);
    
    // Opcional: Atualizar no backend
    await api.put('/user/language', { language: lang });
  };

  return (
    <Container>
      <Title>Selecione o idioma</Title>
      
      <SelectButton
        title="Português"
        selected={language === 'pt'}
        onPress={() => handleSelectLanguage('pt')}
      />
      
      <SelectButton
        title="English"
        selected={language === 'en'}
        onPress={() => handleSelectLanguage('en')}
      />
    </Container>
  );
}
```

---

## Tradução de Dados do Backend

Muitos dados vêm do backend em dois idiomas (ex: `title` e `title_EN`). Use uma função helper:

**Arquivo**: `src/languages/translateDB.js`

```javascript
export function translateDB(item, field, language) {
  if (language === 'en' && item[`${field}_EN`]) {
    return item[`${field}_EN`];
  }
  return item[field];
}
```

**Uso**:

```typescript
import { translateDB } from '../../languages/translateDB';
import { useAuth } from '../../contexts/auth';

function ActivityCard({ activity }) {
  const { language } = useAuth();

  return (
    <Card>
      <Title>{translateDB(activity, 'title', language)}</Title>
      <Subtitle>{translateDB(activity, 'subtitle', language)}</Subtitle>
    </Card>
  );
}
```

### Alternativa com Hook Customizado

```typescript
// src/hooks/useTranslateDB.ts
import { useAuth } from '../contexts/auth';

export function useTranslateDB() {
  const { language } = useAuth();

  const translate = (item: any, field: string) => {
    if (language === 'en' && item[`${field}_EN`]) {
      return item[`${field}_EN`];
    }
    return item[field];
  };

  return { translate };
}

// Uso
function ActivityCard({ activity }) {
  const { translate } = useTranslateDB();

  return <Title>{translate(activity, 'title')}</Title>;
}
```

---

## Navegação com i18n

### Títulos de Tabs

```typescript
import { useTranslation } from 'react-i18next';

function HomeTabs() {
  const { t } = useTranslation();

  return (
    <Tab.Navigator>
      <Tab.Screen
        name={t("Atividades")}
        component={ActivitysHistory}
      />
      <Tab.Screen
        name={t("Centro Estético")}
        component={BeautyCenterHistory}
      />
      <Tab.Screen
        name={t("Espaços")}
        component={Reserves}
      />
    </Tab.Navigator>
  );
}
```

### Headers

```typescript
<Header title={t("Configurações")} showBack={true} />
```

---

## Formatação de Datas e Números

### Datas com moment

```bash
npm install moment moment-timezone
```

```typescript
import moment from 'moment';
import 'moment/locale/pt-br';
import { useAuth } from '../contexts/auth';

function DateDisplay({ date }) {
  const { language } = useAuth();
  
  moment.locale(language === 'pt' ? 'pt-br' : 'en');
  
  return <Text>{moment(date).format('LL')}</Text>;
}
```

### Números e Moeda

```typescript
import { useAuth } from '../contexts/auth';

function PriceDisplay({ value }) {
  const { language } = useAuth();
  
  const formatted = new Intl.NumberFormat(
    language === 'pt' ? 'pt-BR' : 'en-US',
    {
      style: 'currency',
      currency: language === 'pt' ? 'BRL' : 'USD'
    }
  ).format(value);
  
  return <Text>{formatted}</Text>;
}
```

---

## Persistência de Idioma

### Salvar Preferência

```typescript
await AsyncStorage.setItem('@ClubeScania:language', JSON.stringify('en'));
```

### Carregar na Inicialização

No `AuthContext`:

```typescript
useEffect(() => {
  async function loadStorage() {
    const language = await AsyncStorage.getItem('@ClubeScania:language');
    
    if (language) {
      updateLanguage(JSON.parse(language));
    }
  }

  loadStorage();
}, []);
```

### Sincronizar com Backend

Quando o usuário troca idioma, salvar no perfil:

```typescript
const handleChangeLanguage = async (lang: string) => {
  // Atualizar localmente
  await updateLanguage(lang);
  
  // Atualizar no backend
  try {
    await api.put('/user/language', { language: lang });
  } catch (error) {
    console.error('Erro ao atualizar idioma no servidor', error);
  }
};
```

---

## Organização de Traduções

### Por Módulo

Recomenda-se organizar traduções por módulo para facilitar manutenção:

```
src/languages/
├── i18n.js
├── pt/
│   ├── common.json       # Textos comuns
│   ├── auth.json         # Autenticação
│   ├── activities.json   # Atividades
│   ├── events.json       # Eventos
│   ├── profile.json      # Perfil
│   └── errors.json       # Mensagens de erro
└── en/
    ├── common.json
    ├── auth.json
    ├── activities.json
    ├── events.json
    ├── profile.json
    └── errors.json
```

**Configuração**:

```javascript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

import ptCommon from './pt/common.json';
import ptAuth from './pt/auth.json';
import enCommon from './en/common.json';
import enAuth from './en/auth.json';

i18n
  .use(initReactI18next)
  .init({
    resources: {
      pt: {
        common: ptCommon,
        auth: ptAuth
      },
      en: {
        common: enCommon,
        auth: enAuth
      }
    },
    defaultNS: 'common',
    fallbackLng: 'pt'
  });
```

**Uso**:

```typescript
const { t } = useTranslation('auth');
<Text>{t("Entrar")}</Text>
```

---

## Detecção Automática de Idioma

### Pelo Sistema Operacional

```bash
npm install expo-localization
```

```typescript
import * as Localization from 'expo-localization';

const deviceLanguage = Localization.locale.split('-')[0]; // 'pt' ou 'en'

i18n.init({
  lng: deviceLanguage,
  // ...
});
```

### Pelo Backend

Quando o usuário faz login, usar idioma salvo no perfil:

```typescript
async function singIn(username: string, password: string) {
  const response = await auth.singInService(username, password);
  
  if (!response.error) {
    // Usar idioma do usuário
    updateLanguage(response.user?.idioma ?? 'pt');
  }
}
```

---

## Validação com i18n

### Mensagens de Erro em Yup

```typescript
import * as yup from 'yup';
import { useTranslation } from 'react-i18next';

function SignUpForm() {
  const { t } = useTranslation();

  const schema = yup.object({
    email: yup
      .string()
      .required(t("E-mail obrigatório"))
      .email(t("E-mail inválido")),
    password: yup
      .string()
      .required(t("Senha obrigatória"))
      .min(6, t("Senha deve ter no mínimo 6 caracteres"))
  });

  // ...
}
```

---

## Testes com i18n

### Mock do i18next

```typescript
jest.mock('react-i18next', () => ({
  useTranslation: () => ({
    t: (key: string) => key,
    i18n: {
      changeLanguage: jest.fn(),
      language: 'pt'
    }
  })
}));
```

---

## Boas Práticas

### 1. Sempre use chaves descritivas

```typescript
// ✅ Bom
t("Agendamento realizado com sucesso")

// ❌ Ruim
t("msg1")
```

### 2. Mantenha consistência

Use sempre os mesmos termos para as mesmas ações:

- "Salvar" / "Save"
- "Cancelar" / "Cancel"
- "Confirmar" / "Confirm"

### 3. Evite concatenação

```typescript
// ❌ Ruim
<Text>{t("Olá")} {user.nome}</Text>

// ✅ Bom
<Text>{t("Olá, {{name}}!", { name: user.nome })}</Text>
```

### 4. Traduza mensagens de erro

```typescript
// ❌ Ruim
Alert.alert('Erro', 'Erro ao carregar dados');

// ✅ Bom
Alert.alert(t("Erro"), t("Erro ao carregar dados"));
```

### 5. Use namespace para organização

```typescript
const { t } = useTranslation('activities');
<Text>{t("Reservar")}</Text> // activities:Reservar
```

---

## Checklist de Tradução

Ao adicionar nova funcionalidade:

- [ ] Adicionar textos em `portuguese.json`
- [ ] Adicionar traduções em `english.json`
- [ ] Usar `t()` em todos os textos visíveis
- [ ] Traduzir mensagens de erro
- [ ] Traduzir validações de formulário
- [ ] Traduzir títulos de navegação
- [ ] Testar em ambos os idiomas
- [ ] Verificar formatação de datas/números

---

## Próximos Passos

- [Build e Deploy](./BUILD-DEPLOY.md)
- [Navegação](./NAVEGACAO.md)
- [Componentes](./COMPONENTES.md)
